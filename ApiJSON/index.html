<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Ficticia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
</head>
<body>
    <h1>API Ficticia</h1>

    <h2>Obtener Usuarios</h2>
    <button onclick="getUsers()">Obtener Usuarios</button>
    <ul id="userList" style="display: none;"></ul>

    <h2>Crear Usuario</h2>
    <button onclick="showCreateForm()">Crear Usuario</button>
    <div id="createForm" style="display: none;">
        <label for="newUserName">Nombre:</label>
        <input type="text" id="newUserName" required>
        <br>
        <label for="newUserEmail">Email:</label>
        <input type="email" id="newUserEmail" required>
        <br>
        <button onclick="createUser()">Crear</button>
    </div>

    <h2>Actualizar Usuario</h2>
    <button onclick="updateUser()">Actualizar Usuario</button>

    <script>
        function getUsers() {
            fetch('api.php')
                .then(response => response.json())
                .then(users => {
                    const userList = document.getElementById('userList');
                    userList.innerHTML = ''; // Limpiar lista existente

                    users.forEach(user => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            <span>ID: ${user.id}, Nombre: ${user.name}, Email: ${user.email}</span>
                            <i class="fas fa-pencil-alt" style="margin-left: 10px; cursor: pointer;" onclick="editUser(${user.id})"></i>
                            <i class="fas fa-trash-alt" style="margin-left: 10px; cursor: pointer;" onclick="confirmDeleteUser(${user.id})"></i>
                        `;
                        userList.appendChild(listItem);
                    });

                    userList.style.display = 'block'; // Mostrar la lista
                })
                .catch(error => console.error('Error:', error));
        }

        function showCreateForm() {
            document.getElementById('createForm').style.display = 'block';
        }

        function createUser() {
            const nameInput = document.getElementById('newUserName');
            const emailInput = document.getElementById('newUserEmail');

            const user = {
                name: nameInput.value,
                email: emailInput.value
            };

            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(user),
            })
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(error => console.error('Error:', error));

            // Limpiar el formulario y ocultarlo después de enviar la solicitud
            nameInput.value = '';
            emailInput.value = '';
            document.getElementById('createForm').style.display = 'none';
        }

        function updateUser() {
            const userId = prompt('Ingrese el ID del usuario que desea actualizar:');
            if (userId !== null) {
                const newName = prompt('Ingrese el nuevo nombre de usuario:');
                const newEmail = prompt('Ingrese el nuevo correo:');
                if (newName !== null && newEmail !== null) {
                    const updatedUser = {
                        name: newName,
                        email: newEmail
                    };

                    fetch(`api.php?id=${userId}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updatedUser),
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            alert('Usuario actualizado con éxito');
                            getUsers(); // Actualizar la lista de usuarios después de la edición
                        })
                        .catch(error => console.error('Error:', error));
                }
            }
        }

        function editUser(userId) {
            console.log('Editando usuario con ID:', userId);
            updateUser(); // Llamar a la función de actualización para este ejemplo
        }

        function confirmDeleteUser(userId) {
            const confirmation = confirm('¿Estás seguro de eliminar este usuario?');
            if (confirmation) {
                deleteUser(userId);
            }
        }

        function deleteUser(userId) {
            console.log('Eliminando usuario con ID:', userId);

            fetch(`api.php?id=${userId}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    alert('Usuario eliminado con éxito');
                    getUsers(); // Actualizar la lista de usuarios después de la eliminación
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
